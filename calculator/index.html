<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calculator.app</title>
  <link rel="manifest" href="manifest.json">
  <link href="./images/logo.png">
  <link rel="stylesheet" href="./content/style.css">
</head>

<body>
  <form class="calculator" name="calc" onkeyup="keyupfunction()">
    <p class="menuBtn"><img src="./images/ellipsis-v-solid.svg" alt="" /></p>
    <input type="text" class="value" name="txt" readonly maxlength="15" placeholder="0" />
    <span class="num seven" onclick="document.calc.txt.value +='7' ">7</span>
    <span class="num eight" onclick="document.calc.txt.value +='8' ">8</span>
    <span class="num nine" onclick="document.calc.txt.value +='9' ">9</span>
    <span class="num change" onclick="document.calc.txt.value = ''">DEL</span>
    <span class="num clear">&#8592</span>
    <span class="num four" onclick="document.calc.txt.value +='4' ">4</span>
    <span class="num five" onclick="document.calc.txt.value +='5' ">5</span>
    <span class="num six" onclick="document.calc.txt.value +='6' ">6</span>
    <span class="num divide" onclick="document.calc.txt.value +='/' ">&divide;</span>
    <span class="num sub" onclick="document.calc.txt.value +='-' ">-</span>
    <span class="num one" onclick="document.calc.txt.value +='1'">1</span>
    <span class="num two" onclick="document.calc.txt.value +='2' ">2</span>
    <span class="num three" onclick="document.calc.txt.value +='3' ">3</span>
    <span class="num add" onclick="document.calc.txt.value +='+' ">+</span>
    <span class="num multi" onclick="document.calc.txt.value +='*' ">&times;</span>

    <!--span class="num" onclick="document.calc.txt.value +='(' ">(</span>
    <span class="num" onclick="document.calc.txt.value +=')' ">)</span-->
    <span class="num zero" onclick="document.calc.txt.value +='0' ">0</span>
    <span class="num dozero" onclick="document.calc.txt.value +='00' ">00</span>
    <span class="num dot" onclick="document.calc.txt.value +='.' ">.</span>
    <span class="num equal" onclick="document.calc.txt.value = eval(calc.txt.value)">=</span>
  </form>

  <section>
    <div class="container">
      <div class="content">
        <p class="btnBar"><img class="closeBtn" src="./images/times-circle-regular.svg" alt="" /></p>
        <img class="logo" src="./images/logo.png" alt="">
        <h2>Talking CalC!</h2><br>
        <p class="para"><b>Introducting Talking CalC!.</b> It is Web (PWA) based Calculator, made using basic <b> Html,
            Css, Js and PWA.</b>
          You can easy Download it and run on any OS without any problem. You can get this app code of GitHub <b>(not
            for commercial
            purpose.)</b></p><br>
 <pwa-install></pwa-install> 
        <a href="https://github.com/imrit-pro/imrit-pro.github.io/tree/61fc8807f933933dbb9a287b5f7bad42b6e07c04/calcapp" target="_blank"><button class="btn github">GitHub <img src="./images/github-brands.svg"
              style="height: 15px; color: #000000;"></button></a><br>
         <select id='voiceList' class="btn voiceList"><option label="Voices"></option></select>
        <p class="vs">VS 0.1</p>
      </div>
    </div>
  </section>
<script>
//Registring SW
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./sw.js');
  });

//calculator function
const del = document.querySelector('.clear');
var a = document.calc.txt.value;
 
del.addEventListener('click', () =>{
	var a = document.calc.txt.value;
	document.calc.txt.value = a.substr(0, a.length-1);
})

//Function to display about box
const menuBtn = document.querySelector('.menuBtn');
const closeBtn = document.querySelector('.closeBtn');
const container = document.querySelector('.container');
const calculator = document.querySelector('.calculator');

menuBtn.addEventListener('click', () => {
	container.classList.add('container-show');
	calculator.classList.add('calculator-show');
});

closeBtn.addEventListener('click', () => {
	container.classList.remove('container-show');
	calculator.classList.add('calculator-close');
});



//text-to-speech api

var txtInput = document.querySelector('.value');
var voiceList = document.querySelector('#voiceList');
var btnSpeak = document.querySelector('.equal');
var synth = window.speechSynthesis;
var voices = [];

PopulateVoices();
if(speechSynthesis !== undefined){
	speechSynthesis.onvoiceschanged = PopulateVoices;
}

btnSpeak.addEventListener('click', ()=> {
	var toSpeak = new SpeechSynthesisUtterance(txtInput.value);
	var selectedVoiceName = voiceList.selectedOptions[0].getAttribute('data-name');
	voices.forEach((voice)=>{
		if(voice.name === selectedVoiceName){
			toSpeak.voice = voice;
		}
	});
	synth.speak(toSpeak);
});

function PopulateVoices(){
	voices = synth.getVoices();
	var selectedIndex = voiceList.selectedIndex < 0 ? 0 : voiceList.selectedIndex;
	voiceList.innerHTML = '';
	voices.forEach((voice)=>{
		var listItem = document.createElement('option');
		listItem.textContent = voice.name;
		listItem.setAttribute('data-lang', voice.lang);
		listItem.setAttribute('data-name', voice.name);
		voiceList.appendChild(listItem);
	});

	voiceList.selectedIndex = selectedIndex;
}

let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent Chrome 67 and earlier from automatically showing the prompt
  e.preventDefault();
  // Stash the event so it can be triggered later.
  deferredPrompt = e;
  // Update UI notify the user they can add to home screen
  btnAdd.style.display = 'block';
});

btnAdd.addEventListener('click', (e) => {
  // hide our user interface that shows our A2HS button
  btnAdd.style.display = 'none';
  // Show the prompt
  deferredPrompt.prompt();
  // Wait for the user to respond to the prompt
  deferredPrompt.userChoice
    .then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the A2HS prompt');
      } else {
        console.log('User dismissed the A2HS prompt');
      }
      deferredPrompt = null;
    });
}); 

/*
var msg;

  window.addEventListener('beforeinstallprompt', (e) => {

    e.preventDefault();

    msg = e;

  });

  function install() {

    msg.prompt();

  }

  window.onerror = function(errorMsg, url, lineNumber) {

    alert('Error: ' + errorMsg + ' Script: ' + url + ' Line: ' + lineNumber);

  }
*/

</script>
  <!--script src="./content/main.js"></script-->
<!--script type="module" src="https://cdn.jsdelivr.net/npm/@pwabuilder/pwainstall@latest/dist/pwa-install.min.js"></script-->
</body>

</html>
